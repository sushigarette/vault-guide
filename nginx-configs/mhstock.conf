# Configuration Nginx pour mhstock
# À placer dans /etc/nginx/sites-available/mhstock
# Puis créer un lien symbolique : sudo ln -s /etc/nginx/sites-available/mhstock /etc/nginx/sites-enabled/mhstock

# ⚠️ IMPORTANT : Assets pour mhstock AVANT la location générale /mhstock/
# Cette location doit être AVANT location /mhstock/ pour avoir la priorité
location /mhstock/assets/ {
    alias /var/www/mhstock/dist/assets/;
    expires 1y;
    add_header Cache-Control "public, immutable";
    
    # Types MIME corrects
    location ~* \.js$ {
        add_header Content-Type "application/javascript; charset=utf-8";
    }
    
    location ~* \.css$ {
        add_header Content-Type "text/css; charset=utf-8";
    }
}

# Service Worker et fichiers statiques pour mhstock
location ~* ^/mhstock/(sw\.js|manifest\.json|favicon\.(ico|svg)|apple-touch-icon\.png|icon-.*\.png|robots\.txt|placeholder\.svg)$ {
    root /var/www/mhstock/dist;
    rewrite ^/mhstock/(.*)$ /$1 break;
    add_header Cache-Control "public, max-age=3600";
}

# Configuration principale pour mhstock
location /mhstock/ {
    alias /var/www/mhstock/dist/;
    index index.html;
    try_files $uri $uri/ @mhstock_fallback;

    # Headers de sécurité
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}

# Fallback pour mhstock (routing React - SPA)
location @mhstock_fallback {
    rewrite ^/mhstock/(.*)$ /mhstock/index.html last;
}

# API pour mhstock (si nécessaire)
location /mhstock-api/ {
    proxy_pass http://localhost:3002;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

